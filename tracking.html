<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Burke Crypto Analytics - Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- FONTS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --lavender: #dcd0ff;
      --blue: #71c5ff;
      --text-main: #f6f3ff;
      --text-muted: #a9b0d6;
      --success: #5dd9a3;
      --danger: #ff5c8a;
    }

    .soft-glow {
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7);
    }

    .underline-soft {
      position: relative;
    }
    .underline-soft::after {
      content: "";
      display: block;
      width: 45%;
      height: 1px;
      margin-top: 0.3rem;
      background: var(--lavender);
      border-radius: 1px;
      box-shadow: 0 3px 6px rgba(113,197,255,0.6);
    }

    .hidden { display: none; }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100%;
      background: #050716;
      color: var(--text-main);
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }

    .app-shell {
      max-width: 480px;
      margin: 0 auto;
      padding: 1rem;
      background: rgba(15,18,42,0.9);
      backdrop-filter: blur(8px);
      border-radius: 36px;
      box-shadow: 0 24px 80px rgba(0,0,0,0.45);
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .hamburger {
      width: 32px;
      height: 24px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
    }
    .hamburger .bar {
      width: 100%;
      height: 4px;
      border-radius: 4px;
      background: linear-gradient(90deg, #bfa8ff, #71c5ff);
      box-shadow:
        0 0 3px var(--blue),
        0 0 7px rgba(113,197,255,0.8);
    }

    .logo-title {
      flex: 1;
      text-align: center;
      font-family: "Playfair Display", serif;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-right: 18px;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(20px);
      background: rgba(10,12,32,0.65);
      transition: left .35s ease;
      z-index: 999;
      padding: 1.5rem;
    }
    .menu-overlay.active { left: 0; }

    .menu-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      font-size: 2rem;
      line-height: 1;
      color: var(--lavender);
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7),
        0 0 10px rgba(113,197,255,0.5);
    }

    .menu-title {
      margin-top: 3.5rem;
      text-align: center;
      font-family: "Playfair Display", serif;
      font-size: 1.4rem;
      color: var(--lavender);
    }

    .menu-items {
      margin-top: 3.5rem;
      text-align: center;
    }
    .menu-item {
      display: block;
      font-family: "Playfair Display", serif;
      font-size: 1.6rem;
      margin: 1.3rem 0;
      color: var(--lavender);
      letter-spacing: 0.06em;
      cursor: pointer;
      text-decoration: none;
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7);
    }
    .menu-item::after {
      content: "";
      display: block;
      width: 55%;
      height: 1px;
      background: var(--lavender);
      border-radius: 1px;
      margin: 0.35rem auto 0;
      box-shadow: 0 3px 6px rgba(113,197,255,0.6);
    }

    .card {
      margin-top: 1rem;
      padding: 1.3rem 1.2rem;
      background: rgba(12,14,35,0.95);
      border-radius: 24px;
      border: 1px solid rgba(140,155,255,0.3);
    }

    .page-title {
      font-family: "Playfair Display", serif;
      font-size: 1.4rem;
      color: var(--lavender);
      margin: 0;
      letter-spacing: 0.03em;
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7);
    }

    .view-description {
      margin: .6rem 0 1rem;
      color: var(--text-muted);
      font-size: .8rem;
    }

    .pill-row {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      flex-wrap: wrap;
    }

    .primary-pill {
      background: linear-gradient(135deg, #bfa8ff, #71c5ff);
      color: #06061a;
      padding: 0.55rem 1.2rem;
      border-radius: 999px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      box-shadow:
        0 0 3px var(--blue),
        0 0 7px rgba(113,197,255,0.8);
      transition: opacity 0.15s ease, transform 0.1s ease;
    }
    .primary-pill:active {
      transform: scale(0.98);
    }

    .ghost-pill {
      background: transparent;
      border: 1px solid rgba(165, 177, 255, 0.5);
      color: var(--lavender);
      padding: 0.55rem 1.2rem;
      border-radius: 999px;
      cursor: pointer;
      transition: opacity 0.15s ease, transform 0.1s ease;
    }
    .ghost-pill:active {
      transform: scale(0.98);
    }

    .pill-busy {
      opacity: 0.6;
      cursor: wait;
    }

    #lastUpdated {
      margin-top: 0.4rem;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    /* OVERLAY MODALS */
    .overlay {
      position: fixed;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(18px);
      background: rgba(5, 7, 22, 0.7);
      z-index: 1000;
    }
    .overlay.hidden {
      display: none;
    }

    .token-form {
      width: 100%;
      max-width: 420px;
      margin: 0;
      padding: 1rem;
      background: rgba(16,18,45,0.98);
      border-radius: 18px;
      border: 1px solid rgba(140,155,255,0.7);
      position: relative;
      box-shadow:
        0 18px 40px rgba(0,0,0,0.8),
        0 0 8px rgba(113,197,255,0.4);
    }

    .token-form-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.4rem;
    }

    .token-form-title {
      font-family: "Playfair Display", serif;
      font-size: 1rem;
      color: var(--lavender);
    }

    .token-form-close {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.4rem;
      line-height: 1;
      color: var(--lavender);
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7);
    }

    .token-form-subtext {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.7rem;
    }

    .form-row { margin-bottom: 0.6rem; }
    .form-label {
      display: block;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.2rem;
    }

    .form-help {
      margin-top: 0.25rem;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .token-input,
    .token-select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(140,155,255,0.5);
      background: rgba(10,12,35,0.95);
      color: var(--text-main);
      padding: 0.5rem 0.8rem;
      font-size: 0.8rem;
      font-family: inherit;
    }

    .token-input::placeholder {
      color: rgba(169,176,214,0.7);
    }

    .tokens-list {
      margin-top: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .token-card {
      position: relative;
      border-radius: 20px;
      padding: 0.85rem 1rem;
      background:
        radial-gradient(circle at top left, rgba(113,197,255,0.2), rgba(10,12,35,0.98));
      border: 1px solid rgba(140,155,255,0.7);
      box-shadow:
        0 18px 40px rgba(0,0,0,0.75),
        0 0 8px rgba(113,197,255,0.4);
    }

    .token-card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.2rem;
    }

    .token-card-header {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .token-card-amount {
      font-size: 0.74rem;
      color: var(--text-muted);
      margin-bottom: 0.55rem;
    }

    .token-row-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.78rem;
      margin: 0.1rem 0;
    }

    .token-row-label {
      color: var(--text-muted);
    }

    .token-row-value {
      font-weight: 500;
    }

    .token-pnl-positive { color: var(--success); }
    .token-pnl-negative { color: var(--danger); }

    .token-pct {
      margin-left: 0.4rem;
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(10,12,35,0.95);
      border: 1px solid currentColor;
    }

    .token-rowan {
      margin-top: 0.45rem;
      font-size: 0.7rem;
      color: var(--text-muted);
      font-style: italic;
    }

    #emptyState {
      margin-top: 0.8rem;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .token-menu-btn {
      background: transparent;
      border: none;
      color: var(--lavender);
      font-size: 1.2rem;
      padding: 0;
      cursor: pointer;
    }

    .token-menu {
      position: absolute;
      top: 0.6rem;
      right: 0.8rem;
      background: rgba(8,10,30,0.98);
      border-radius: 12px;
      border: 1px solid rgba(140,155,255,0.7);
      box-shadow: 0 14px 30px rgba(0,0,0,0.8);
      padding: 0.25rem 0;
      min-width: 120px;
      z-index: 10;
    }

    .token-menu-item {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--text-main);
      font-size: 0.78rem;
      text-align: left;
      padding: 0.35rem 0.8rem;
      cursor: pointer;
    }

    .token-menu-item:not(:last-child) {
      border-bottom: 1px solid rgba(40,50,100,0.8);
    }

    .token-menu-delete {
      color: var(--danger);
    }
  </style>
</head>

<body>

  <!-- MENU OVERLAY -->
  <div class="menu-overlay" id="menuOverlay">
    <button class="menu-close" id="menuClose">×</button>

    <div class="menu-title soft-glow">Menu</div>

    <div class="menu-items">
      <a class="menu-item" href="index.html">Overview</a>
      <a class="menu-item" href="tracking.html">Tracker</a>
      <a class="menu-item" href="charts.html">Charts</a>
    </div>
  </div>

  <div class="app-shell">
    <header class="top-bar">
      <div class="hamburger" id="hamburger">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </div>
      <div class="logo-title">Burke Crypto Analytics</div>
    </header>

    <main class="card">
      <h2 class="page-title underline-soft">Tracker</h2>
      <p class="view-description">
        Track your tokens, costs, and profit/loss. Rowan will roast accordingly.
      </p>

      <div class="pill-row">
        <button id="addTokenBtn" class="primary-pill" type="button">Add Token</button>
        <button id="refreshPricesBtn" class="ghost-pill" type="button">Refresh prices</button>
      </div>
      <p id="lastUpdated"></p>

      <p id="emptyState">No tokens yet. Add one to get started.</p>
      <div id="tokensList" class="tokens-list"></div>
    </main>
  </div>

  <!-- ADD / EDIT TOKEN OVERLAY -->
  <!-- (keeping your existing form markup – unchanged) -->
  <!-- ... your form HTML stays here ... -->

  <!-- I’m not re-pasting the entire form/overlay HTML to keep this message under limits,
       but the ONLY changes I made are in the <style> for .token-rowan
       and in the <script> below: sorting + Rowan roasts. Use this JS as the updated part. -->

  <script>
    /* MENU BEHAVIOR */
    const hamburger   = document.getElementById("hamburger");
    const menuOverlay = document.getElementById("menuOverlay");
    const menuClose   = document.getElementById("menuClose");

    hamburger.addEventListener("click", () => {
      menuOverlay.classList.add("active");
    });
    menuClose.addEventListener("click", () => {
      menuOverlay.classList.remove("active");
    });
    menuOverlay.addEventListener("click", (e) => {
      if (e.target === menuOverlay) {
        menuOverlay.classList.remove("active");
      }
    });

    /* TOKEN FORM + TRACKER LOGIC */
    const addTokenBtn        = document.getElementById("addTokenBtn");
    const refreshPricesBtn   = document.getElementById("refreshPricesBtn");
    const lastUpdatedEl      = document.getElementById("lastUpdated");
    const tokensList         = document.getElementById("tokensList");
    const emptyState         = document.getElementById("emptyState");

    const STORAGE_KEY = "bca_tokens_v1";
    let tokens = [];

    const COINGECKO_MAP = {
      BTC: "bitcoin",
      ETH: "ethereum",
      SOL: "solana",
      XRP: "ripple",
      DOGE: "dogecoin",
      ADA: "cardano"
    };

    // Rowan per-token sayings
    const ROWAN_UP = [
      "finally, one of your bags is doing something.",
      "don\u2019t let this go to your head.",
      "even a blind trader catches a green candle sometimes.",
      "okay profit prince/princess, calm down.",
      "screenshot it before it disappears."
    ];

    const ROWAN_DOWN = [
      "you bought what\u2026 at which price?",
      "this token said \u2018down only\u2019 and you said \u2018sure.\u2019",
      "hey, you\u2019re funding the winners\u2019 profits. generous.",
      "did you buy the top? be honest.",
      "I\u2019ve seen rugs with better recovery attempts."
    ];

    const ROWAN_FLAT = [
      "this chart is giving \u2018nobody cares.\u2019",
      "your coin is taking a personal day.",
      "flat. like\u2026 pancake flat.",
      "this thing moves less than your motivation.",
      "market: \u2018I\u2019m not mad, I\u2019m just indifferent.\u2019"
    ];

    function pickRowan(list) {
      if (!list || !list.length) return "";
      const idx = Math.floor(Math.random() * list.length);
      return list[idx];
    }

    let formMode     = "new";   // "new" | "edit"
    let editingIndex = null;
    let addMoreIndex = null;

    function loadTokens() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        tokens = raw ? JSON.parse(raw) : [];
      } catch (e) {
        tokens = [];
      }
    }

    function saveTokens() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tokens));
      } catch (e) {
        console.error("Failed to save tokens", e);
      }
    }

    function renderTokens() {
      tokensList.innerHTML = "";

      if (!tokens.length) {
        emptyState.style.display = "block";
        return;
      }

      emptyState.style.display = "none";

      // Sort tokens by profit (highest first)
      tokens.sort((a, b) => (b.pnl || 0) - (a.pnl || 0));

      tokens.forEach((t, index) => {
      const tolerance = 0.01;
      let roastText;
      if (t.pnl > tolerance) {
        roastText = pickRowan(ROWAN_UP);
      } else if (t.pnl < -tolerance) {
        roastText = pickRowan(ROWAN_DOWN);
      } else {
        roastText = pickRowan(ROWAN_FLAT);
      }

        const isProfit = t.pnl >= 0;
        const pnlClass = isProfit ? "token-pnl-positive" : "token-pnl-negative";
        const sign = isProfit ? "+" : "";
        const pct = t.cost !== 0 ? (t.pnl / t.cost) * 100 : 0;

        const card = document.createElement("div");
        card.className = "token-card";
        card.dataset.index = index;

        card.innerHTML = `
          <div class="token-card-header-row">
            <div class="token-card-header">${t.name} (${t.symbol})</div>
            <button class="token-menu-btn" type="button" aria-label="Token menu">⋮</button>
            <div class="token-menu hidden">
              <button class="token-menu-item" data-action="edit" type="button">Edit</button>
              <button class="token-menu-item" data-action="add" type="button">Add</button>
              <button class="token-menu-item token-menu-delete" data-action="delete" type="button">Delete</button>
            </div>
          </div>

          <div class="token-card-amount">Amount: ${t.amount}</div>

          <div class="token-row-line">
            <div class="token-row-label">Cost</div>
            <div class="token-row-value">$${t.cost.toFixed(2)}</div>
          </div>

          <div class="token-row-line">
            <div class="token-row-label">Value</div>
            <div class="token-row-value ${pnlClass}">
              $${t.value.toFixed(2)}
              <span class="token-pct ${pnlClass}">${sign}${pct.toFixed(2)}%</span>
            </div>
          </div>

          <div class="token-row-line">
            <div class="token-row-label">${isProfit ? "Profit" : "Loss"}</div>
            <div class="token-row-value ${pnlClass}">$${t.pnl.toFixed(2)}</div>
          </div>

          <div class="token-rowan">${roastText}</div>
        `;

        tokensList.appendChild(card);
      });
    }

    // (rest of your existing JS: price fetching, menus, form handling, etc.)
    // Keep everything else exactly as it is below this point.
  </script>
</body>
</html>
