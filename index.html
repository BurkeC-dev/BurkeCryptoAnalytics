<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Burke Crypto Analytics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- FONTS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --lavender: #dcd0ff;
      --blue: #71c5ff;
      --text-main: #f6f3ff;
      --text-muted: #a9b0d6;
      --success: #5dd9a3;
      --danger: #ff5c8a;
    }

    .soft-glow {
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7);
    }

    .underline-soft {
      position: relative;
    }
    .underline-soft::after {
      content: "";
      display: block;
      width: 45%;
      height: 1px;
      margin-top: 0.3rem;
      background: var(--lavender);
      border-radius: 1px;
      box-shadow: 0 3px 6px rgba(113,197,255,0.6);
    }

    .hidden { display: none; }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100%;
      background: #050716;
      color: var(--text-main);
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }

    .app-shell {
      max-width: 480px;
      margin: 0 auto;
      padding: 1rem;
      background: rgba(15,18,42,0.9);
      backdrop-filter: blur(8px);
      border-radius: 36px;
      box-shadow: 0 24px 80px rgba(0,0,0,0.45);
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .hamburger {
      width: 32px;
      height: 24px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
    }
    .hamburger .bar {
      width: 100%;
      height: 4px;
      border-radius: 4px;
      background: linear-gradient(90deg, #bfa8ff, #71c5ff);
      box-shadow:
        0 0 3px var(--blue),
        0 0 7px rgba(113,197,255,0.8);
    }

    .logo-title {
      flex: 1;
      text-align: center;
      font-family: "Playfair Display", serif;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-right: 18px;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(20px);
      background: rgba(10,12,32,0.65);
      transition: left .35s ease;
      z-index: 999;
      padding: 1.5rem;
    }
    .menu-overlay.active { left: 0; }

    .menu-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      font-size: 2rem;
      line-height: 1;
      color: var(--lavender);
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7),
        0 0 10px rgba(113,197,255,0.5);
    }

    .menu-title {
      margin-top: 3.5rem;
      text-align: center;
      font-family: "Playfair Display", serif;
      font-size: 1.4rem;
      color: var(--lavender);
    }

    .menu-items {
      margin-top: 3.5rem;
      text-align: center;
    }
    .menu-item {
      font-family: "Playfair Display", serif;
      font-size: 1.8rem;
      margin: 1.5rem 0;
      color: var(--lavender);
      letter-spacing: 0.06em;
      cursor: pointer;
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7);
    }
    .menu-item::after {
      content: "";
      display: block;
      width: 55%;
      height: 1px;
      background: var(--lavender);
      border-radius: 1px;
      margin: 0.35rem auto 0;
      box-shadow: 0 3px 6px rgba(113,197,255,0.6);
    }

    .card {
      margin-top: 1rem;
      padding: 1.3rem 1.2rem;
      background: rgba(12,14,35,0.95);
      border-radius: 24px;
      border: 1px solid rgba(140,155,255,0.3);
    }

    .page-view { display: none; }
    .page-view.active { display: block; }

    .page-title {
      font-family: "Playfair Display", serif;
      font-size: 1.4rem;
      color: var(--lavender);
      margin: 0;
      letter-spacing: 0.03em;
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7);
    }

    .view-description {
      margin: .6rem 0 1rem;
      color: var(--text-muted);
      font-size: .8rem;
    }

    .primary-pill {
      background: linear-gradient(135deg, #bfa8ff, #71c5ff);
      color: #06061a;
      padding: 0.55rem 1.2rem;
      border-radius: 999px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      margin-right: .6rem;
      box-shadow:
        0 0 3px var(--blue),
        0 0 7px rgba(113,197,255,0.8);
    }
    .ghost-pill {
      background: transparent;
      border: 1px solid rgba(165, 177, 255, 0.5);
      color: var(--lavender);
      padding: 0.55rem 1.2rem;
      border-radius: 999px;
      cursor: pointer;
    }

    .token-form {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(16,18,45,0.95);
      border-radius: 18px;
      border: 1px solid rgba(140,155,255,0.45);
      position: relative;
    }

    .token-form-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.4rem;
    }

    .token-form-title {
      font-family: "Playfair Display", serif;
      font-size: 1rem;
      color: var(--lavender);
    }

    .token-form-close {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.4rem;
      line-height: 1;
      color: var(--lavender);
      text-shadow:
        0 0 2px var(--blue),
        0 0 6px rgba(113,197,255,0.7);
    }

    .token-form-subtext {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.7rem;
    }

    .form-row { margin-bottom: 0.6rem; }
    .form-label {
      display: block;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.2rem;
    }

    .token-input,
    .token-select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(140,155,255,0.5);
      background: rgba(10,12,35,0.95);
      color: var(--text-main);
      padding: 0.5rem 0.8rem;
      font-size: 0.8rem;
      font-family: inherit;
    }

    .token-input::placeholder {
      color: rgba(169,176,214,0.7);
    }

    .table-wrapper {
      margin-top: 1rem;
      padding: .8rem;
      background: rgba(16,18,45,0.95);
      border-radius: 16px;
      border: 1px solid rgba(140,155,255,0.3);
    }
    table {
      width: 100%;
      font-size: .75rem;
      color: var(--text-main);
      border-collapse: collapse;
    }
    td {
      padding: .35rem 0;
      border-top: 1px solid rgba(60,70,120,0.5);
      vertical-align: top;
    }
    @media (max-width: 600px) {
      table thead { display: none; }
      table td { display: block; border-top: none; }
      table tr {
        border-top: 1px solid rgba(60,70,120,0.45);
        margin-bottom: .6rem;
      }
    }

    .token-name { font-weight: 600; }
    .token-meta {
      color: var(--text-muted);
      font-size: 0.72rem;
    }
    .token-pnl-positive { color: var(--success); }
    .token-pnl-negative { color: var(--danger); }

    .tot-card {
      background: rgba(20,22,45,0.9);
      border: 1px solid rgba(140,155,255,0.35);
      border-radius: 16px;
      padding: .75rem;
      margin-bottom: .6rem;
    }
  </style>
</head>

<body>

  <!-- MENU OVERLAY -->
  <div class="menu-overlay" id="menuOverlay">
    <button class="menu-close" id="menuClose">×</button>

    <div class="menu-title soft-glow">Menu</div>

    <div class="menu-items">
      <div class="menu-item" data-view="overview">Overview</div>
      <div class="menu-item" data-view="tracking">Tracker</div>
    </div>
  </div>

  <div class="app-shell">
    <header class="top-bar">
      <div class="hamburger" id="hamburger">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </div>
      <div class="logo-title">Burke Crypto Analytics</div>
    </header>

    <main class="card">

      <!-- OVERVIEW PAGE -->
      <section class="page-view" id="overviewView">
        <h2 class="page-title underline-soft">Overview</h2>
        <p class="view-description">
          Your total crypto summary — soft, calm, and clear.
        </p>
        <div id="totSummary"></div>
        <div id="totCards"></div>
      </section>

      <!-- TRACKING PAGE -->
      <section class="page-view" id="trackingView">
        <h2 class="page-title underline-soft">Tracking</h2>
        <p class="view-description">
          Add tokens, lock entries, and track your coins effortlessly.
        </p>

        <button id="addTokenBtn" class="primary-pill">Add token</button>
        <button id="refreshPricesBtn" class="ghost-pill">Refresh prices</button>

        <!-- TOKEN FORM PANEL -->
        <div id="tokenForm" class="token-form hidden">
          <div class="token-form-header">
            <div>
              <div class="token-form-title">New token entry</div>
              <div class="token-form-subtext">
                Choose a coin, log your entry, we’ll track the rest.
              </div>
            </div>
            <button class="token-form-close" id="tokenFormClose">×</button>
          </div>

          <form id="tokenFormElement">
            <div class="form-row">
              <label class="form-label" for="quickCoinSelect">Quick coin select</label>
              <select id="quickCoinSelect" class="token-select">
                <option value="">Choose a popular coin…</option>
                <option value="bitcoin|BTC|Bitcoin">Bitcoin (BTC)</option>
                <option value="ethereum|ETH|Ethereum">Ethereum (ETH)</option>
                <option value="solana|SOL|Solana">Solana (SOL)</option>
                <option value="ripple|XRP|XRP">XRP (XRP)</option>
                <option value="dogecoin|DOGE|Dogecoin">Dogecoin (DOGE)</option>
                <option value="cardano|ADA|Cardano">Cardano (ADA)</option>
              </select>
            </div>

            <div class="form-row">
              <label class="form-label" for="coinName">Name of coin</label>
              <input id="coinName" class="token-input" type="text" placeholder="e.g. Bitcoin" required />
            </div>

            <div class="form-row">
              <label class="form-label" for="coinSymbol">Symbol / ticker</label>
              <input id="coinSymbol" class="token-input" type="text" placeholder="e.g. BTC" required />
            </div>

            <div class="form-row">
              <label class="form-label" id="amountLabel" for="coinAmount">Amount of coin bought</label>
              <input id="coinAmount" class="token-input" type="number" min="0" step="0.00000001" placeholder="e.g. 0.00031829" required />
            </div>

            <div class="form-row">
              <label class="form-label" for="totalSpent">Total spent (USD)</label>
              <input id="totalSpent" class="token-input" type="number" min="0" step="0.01" placeholder="e.g. 411" required />
            </div>

            <div class="form-row" style="margin-top:0.8rem;">
              <button type="submit" class="primary-pill">Save token</button>
            </div>
          </form>
        </div>

        <!-- TOKENS TABLE -->
        <div class="table-wrapper">
          <table>
            <tbody id="tokenTableBody"></tbody>
          </table>
          <p id="emptyState">No tokens yet.</p>
        </div>
      </section>

    </main>
  </div>

  <script>
    /* MENU BEHAVIOR */
    const hamburger    = document.getElementById("hamburger");
    const menuOverlay  = document.getElementById("menuOverlay");
    const menuClose    = document.getElementById("menuClose");

    hamburger.addEventListener("click", () => {
      menuOverlay.classList.add("active");
    });
    menuClose.addEventListener("click", () => {
      menuOverlay.classList.remove("active");
    });

    document.querySelectorAll(".menu-item").forEach(item => {
      item.addEventListener("click", () => {
        const view = item.dataset.view;
        showView(view);
        menuOverlay.classList.remove("active");
      });
    });

    function showView(viewName) {
      document.querySelectorAll(".page-view").forEach(sec =>
        sec.classList.remove("active")
      );
      document.getElementById(viewName + "View").classList.add("active");
    }

    // start on Tracking view because that's what you use most
    showView("tracking");

    /* OVERVIEW ELEMENTS */
    const totSummary = document.getElementById("totSummary");
    const totCards   = document.getElementById("totCards");

    /* TOKEN FORM + TRACKER LOGIC */
    const addTokenBtn      = document.getElementById("addTokenBtn");
    const tokenForm        = document.getElementById("tokenForm");
    const tokenFormClose   = document.getElementById("tokenFormClose");
    const tokenFormElement = document.getElementById("tokenFormElement");

    const quickCoinSelect  = document.getElementById("quickCoinSelect");
    const coinNameInput    = document.getElementById("coinName");
    const coinSymbolInput  = document.getElementById("coinSymbol");
    const amountLabel      = document.getElementById("amountLabel");
    const coinAmountInput  = document.getElementById("coinAmount");
    const totalSpentInput  = document.getElementById("totalSpent");

    const tokenTableBody   = document.getElementById("tokenTableBody");
    const emptyState       = document.getElementById("emptyState");
    const refreshPricesBtn = document.getElementById("refreshPricesBtn");

    const STORAGE_KEY = "burke_crypto_tokens_v1";

    function loadTokens() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.error("Failed to load tokens", e);
        return [];
      }
    }

    function saveTokens(tokens) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tokens));
      } catch (e) {
        console.error("Failed to save tokens", e);
      }
    }

    let tokens = loadTokens();

    const COINGECKO_MAP = {
      BTC: "bitcoin",
      ETH: "ethereum",
      SOL: "solana",
      XRP: "ripple",
      DOGE: "dogecoin",
      ADA: "cardano"
    };

    addTokenBtn.addEventListener("click", () => {
      tokenForm.classList.remove("hidden");
      addTokenBtn.style.display = "none";
    });

    tokenFormClose.addEventListener("click", () => {
      tokenForm.classList.add("hidden");
      addTokenBtn.style.display = "inline-block";
    });

    function updateAmountLabel() {
      const sym = coinSymbolInput.value.trim().toUpperCase();
      if (sym) {
        amountLabel.textContent = `${sym} bought`;
      } else {
        amountLabel.textContent = "Amount of coin bought";
      }
    }

    quickCoinSelect.addEventListener("change", (e) => {
      const value = e.target.value;
      if (!value) return;
      const [id, sym, name] = value.split("|");
      coinNameInput.value = name;
      coinSymbolInput.value = sym;
      updateAmountLabel();
    });

    coinSymbolInput.addEventListener("input", updateAmountLabel);

    async function fetchPricesForIds(ids) {
      if (!ids.length) return {};
      const url =
        "https://api.coingecko.com/api/v3/simple/price?ids=" +
        encodeURIComponent(ids.join(",")) +
        "&vs_currencies=usd";
      const res = await fetch(url);
      if (!res.ok) throw new Error("Price fetch failed");
      return await res.json();
    }

    function renderTokens() {
      tokenTableBody.innerHTML = "";

      if (!tokens.length) {
        emptyState.style.display = "block";
      } else {
        emptyState.style.display = "none";
      }

      let totalCost = 0;
      let totalValue = 0;

      tokens.forEach((t) => {
        const amount = Number(t.amount) || 0;
        const cost   = Number(t.cost) || Number(t.totalSpent) || 0;

        let lastPrice = Number(t.lastPrice);
        if (!lastPrice && amount > 0 && cost > 0) {
          lastPrice = cost / amount;
        }

        const currentValue = lastPrice * amount;
        const diff         = currentValue - cost;
        const isUp         = diff >= 0;
        const pctChange    = cost > 0 ? (diff / cost) * 100 : 0;

        // keep values synced
        t.cost      = cost;
        t.value     = currentValue;
        t.pnl       = diff;
        t.lastPrice = lastPrice;

        totalCost  += cost;
        totalValue += currentValue;

        const tr = document.createElement("tr");

        const leftTd = document.createElement("td");
        leftTd.innerHTML = `
          <div class="token-name">${t.name} (${t.symbol})</div>
          <div class="token-meta">Amount: ${amount}</div>
        `;

        const midTd = document.createElement("td");
        midTd.innerHTML = `
          <div class="token-meta">Buy price</div>
          <div>$${cost.toFixed(2)}</div>
        `;

        const rightTd = document.createElement("td");
        const colorClass = isUp ? "token-pnl-positive" : "token-pnl-negative";
        rightTd.innerHTML = `
          <div class="token-meta">Current value</div>
          <div class="${colorClass}">$${currentValue.toFixed(2)}</div>
          <div class="token-meta">
            Change:
            <span class="${colorClass}">
              ${
                cost > 0
                  ? (isUp ? "+" : "") + pctChange.toFixed(2) + "%"
                  : "—"
              }
            </span>
          </div>
        `;

        tr.appendChild(leftTd);
        tr.appendChild(midTd);
        tr.appendChild(rightTd);
        tokenTableBody.appendChild(tr);
      });

      saveTokens(tokens);
      updateOverview(totalCost, totalValue);
    }

    function updateOverview(totalCost, totalValue) {
      if (!totSummary || !totCards) return;

      if (!tokens.length) {
        totSummary.innerHTML = `
          <p class="view-description">
            Add tokens in the Tracker tab to see an overview here.
          </p>
        `;
        totCards.innerHTML = "";
        return;
      }

      const pnl = totalValue - totalCost;
      const isUp = pnl >= 0;
      const pct = totalCost > 0 ? (pnl / totalCost) * 100 : 0;

      const colorClass = isUp ? "token-pnl-positive" : "token-pnl-negative";

      totSummary.innerHTML = `
        <div class="tot-card">
          <div class="token-name">Total portfolio</div>
          <div class="token-meta">Cost basis: $${totalCost.toFixed(2)}</div>
          <div class="token-meta">
            Current value:
            <span class="${colorClass}">$${totalValue.toFixed(2)}</span>
          </div>
          <div class="token-meta">
            P/L:
            <span class="${colorClass}">
              $${pnl.toFixed(2)} (${totalCost > 0 ? (isUp ? "+" : "") + pct.toFixed(2) : "0.00"}%)
            </span>
          </div>
        </div>
      `;
      totCards.innerHTML = "";
    }

    tokenFormElement.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name       = coinNameInput.value.trim();
      const symbol     = coinSymbolInput.value.trim().toUpperCase();
      const amount     = parseFloat(coinAmountInput.value);
      const totalSpent = parseFloat(totalSpentInput.value);

      if (!name || !symbol || isNaN(amount) || isNaN(totalSpent) || amount <= 0) {
        alert("Please fill out all fields with valid values.");
        return;
      }

      const cost = totalSpent;
      const buyPrice = cost / amount;

      let lastPrice = null;
      const mappedId = COINGECKO_MAP[symbol];

      try {
        if (mappedId) {
          const data = await fetchPricesForIds([mappedId]);
          if (data[mappedId] && typeof data[mappedId].usd === "number") {
            lastPrice = data[mappedId].usd;
          }
        }
      } catch (err) {
        console.error("Price fetch failed, falling back to buy price", err);
      }

      if (lastPrice === null) lastPrice = buyPrice;

      const value = lastPrice * amount;
      const pnl   = value - cost;

      tokens.push({
        name,
        symbol,
        amount,
        totalSpent: cost,
        buyPrice,
        lastPrice,
        cost,
        value,
        pnl
      });

      renderTokens();

      tokenFormElement.reset();
      quickCoinSelect.value = "";
      amountLabel.textContent = "Amount of coin bought";
      tokenForm.classList.add("hidden");
      addTokenBtn.style.display = "inline-block";
    });

    refreshPricesBtn.addEventListener("click", async () => {
      if (!tokens.length) {
        alert("No tokens to refresh yet.");
        return;
      }

      const ids = Array.from(
        new Set(
          tokens
            .map((t) => COINGECKO_MAP[t.symbol])
            .filter(Boolean)
        )
      );

      if (!ids.length) {
        alert("No supported symbols found for price refresh.");
        return;
      }

      refreshPricesBtn.disabled = true;
      refreshPricesBtn.textContent = "Refreshing…";

      try {
        const data = await fetchPricesForIds(ids);

        tokens.forEach((t) => {
          const id = COINGECKO_MAP[t.symbol];
          if (id && data[id] && typeof data[id].usd === "number") {
            t.lastPrice = data[id].usd;
            t.value = t.lastPrice * t.amount;
            t.pnl = t.value - t.cost;
          }
        });

        renderTokens();
      } catch (err) {
        console.error(err);
        alert("Error fetching prices. Try again in a moment.");
      } finally {
        refreshPricesBtn.disabled = false;
        refreshPricesBtn.textContent = "Refresh prices";
      }
    });

    // Initial render
    renderTokens();
  </script>

</body>
</html>
